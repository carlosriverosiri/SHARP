document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("toast");document.querySelectorAll(".copy-btn").forEach(t=>{t.addEventListener("click",async()=>{const n=t.getAttribute("data-url");try{await navigator.clipboard.writeText(n),e.classList.remove("translate-x-full"),setTimeout(()=>{e.classList.add("translate-x-full")},2e3);const s=t.innerHTML;t.innerHTML='\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>\n            </svg>\n            Kopierad!\n          ',t.classList.remove("bg-[#024264]"),t.classList.add("bg-green-600"),setTimeout(()=>{t.innerHTML=s,t.classList.remove("bg-green-600"),t.classList.add("bg-[#024264]")},2e3)}catch(s){console.error("Kunde inte kopiera:",s),alert("Kunde inte kopiera länken. Försök igen.")}})});const t=document.getElementById("search-input"),n=document.querySelectorAll(".category-section"),s=document.getElementById("no-results");t.addEventListener("input",e=>{const t=e.target.value.toLowerCase().trim();let o=!1;n.forEach(e=>{const n=e.querySelectorAll(".link-item");let s=!1;n.forEach(e=>{const n=e,r=n.getAttribute("data-name")||"",a=n.getAttribute("data-shortcode")||"",i=r.includes(t)||a.includes(t);n.style.display=i?"flex":"none",i&&(s=!0,o=!0)}),e.style.display=s?"block":"none"}),s?.classList.toggle("hidden",o)});const o={Diagnoser:"/d/",Operationer:"/o/",Rehab:"/r/","Frågeformulär":"/ff/"},r=document.getElementById("gen-category"),a=document.getElementById("prefix-display"),i=document.getElementById("prefix-inline"),l=document.getElementById("shortcode-preview"),d=document.getElementById("gen-name"),c=document.getElementById("gen-shortcode"),u=document.getElementById("gen-target"),m=document.getElementById("generate-btn"),g=document.getElementById("output-section"),v=document.getElementById("json-output"),L=document.getElementById("copy-json-btn"),p=document.getElementById("error-message"),y=document.getElementById("error-text");function k(e){return e?e.toLowerCase().replace(/[åäö]/g,e=>({"å":"a","ä":"a","ö":"o"}[e]||e)).replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""):""}r?.addEventListener("change",()=>{const e=o[r.value]||"/d/";a.textContent=e,i.textContent=e,f(),w()});const h=document.getElementById("auto-fill-btn");function f(){const e=o[r.value]||"/d/",t=c.value.trim().toLowerCase().replace(/^\//,"");l.textContent=e+(t||"xxx")}h?.addEventListener("click",()=>{const e=d.value.trim();if(e){const t=k(e);c.value=t,f(),w(),h.textContent="✓",h.classList.remove("bg-gray-100"),h.classList.add("bg-green-100","text-green-700"),setTimeout(()=>{h.textContent="Auto",h.classList.remove("bg-green-100","text-green-700"),h.classList.add("bg-gray-100")},1500)}}),d?.addEventListener("input",()=>{if(!c.value.trim()){const e=k(d.value);c.value=e}f(),w()}),c?.addEventListener("input",()=>{f(),w()}),u?.addEventListener("input",w);const E=document.getElementById("live-preview"),x=document.getElementById("preview-name"),b=document.getElementById("preview-url");function w(){const e=d.value.trim(),t=o[r.value]||"/d/",n=c.value.trim().toLowerCase().replace(/^\//,""),s=u.value.trim();e&&n&&s?(x.textContent=e,b.textContent=`www.specialist.se${t}${n}`,E.classList.remove("hidden")):E.classList.add("hidden")}m?.addEventListener("click",()=>{g.classList.add("hidden"),p.classList.add("hidden");const e=r.value,t=d.value.trim(),n=c.value.trim().toLowerCase().replace(/^\//,""),s=u.value.trim();if(!t)return y.textContent="❌ Du måste skriva ett namn (steg 2)",p.classList.remove("hidden"),void d.focus();if(!n)return y.textContent='❌ Du måste skriva en kortkod (steg 3). Klicka på "Auto" för att fylla i automatiskt!',p.classList.remove("hidden"),void c.focus();if(!s)return y.textContent="❌ Du måste skriva vart länken ska gå (steg 4)",p.classList.remove("hidden"),void u.focus();if(!/^[a-z0-9-]+$/.test(n))return y.textContent='❌ Kortkod får endast innehålla små bokstäver (a-z), siffror (0-9) och bindestreck (-). Klicka på "Auto" för att generera en korrekt kortkod!',p.classList.remove("hidden"),void c.focus();const a=(o[e]||"/d/")+n,i=s.startsWith("http://")||s.startsWith("https://"),l={name:t,shortCode:a,target:s,isExternal:i},m=JSON.stringify(l,null,2).replace(/^{/,"    {").replace(/\n/g,"\n    ").replace(/    }$/,"    },");v.textContent=m;const L=document.getElementById("output-category-name");L&&(L.textContent=`"${e}"`),g.classList.remove("hidden"),g.scrollIntoView({behavior:"smooth",block:"nearest"})}),L?.addEventListener("click",async()=>{const t=v.textContent||"";try{await navigator.clipboard.writeText(t);const n=L.innerHTML;L.innerHTML='\n          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>\n          </svg>\n          Kopierad!\n        ',L.classList.remove("bg-slate-700"),L.classList.add("bg-green-600"),e?.classList.remove("translate-x-full"),setTimeout(()=>{e?.classList.add("translate-x-full")},2e3),setTimeout(()=>{L.innerHTML=n,L.classList.remove("bg-green-600"),L.classList.add("bg-slate-700")},2e3)}catch(n){console.error("Kunde inte kopiera:",n),alert("Kunde inte kopiera. Markera och kopiera manuellt.")}})});
