---
/**
 * OpBandage - Bandageinformation efter operation
 */
import bandageStygn from '../../assets/images/operation/bandage-stygn.webp';
import bandageInre from '../../assets/images/operation/bandage-inre.webp';
import bandageYttre from '../../assets/images/operation/bandage-yttre.webp';

interface Props {
  stygnBorttagning?: string;  // ex: "7-14 dagar", "1-2 veckor"
  visaStygn?: boolean;
  extraInfo?: string;
}

const { 
  stygnBorttagning = "7-14 dagar",
  visaStygn = true,
  extraInfo
} = Astro.props;

// Bilddata för bildspelet
const bandageImages = [
  { src: bandageStygn.src, alt: "Stygn efter operation", title: "Stygn" },
  { src: bandageInre.src, alt: "Inre bandage", title: "Inre bandage" },
  { src: bandageYttre.src, alt: "Yttre bandage", title: "Yttre bandage" }
];
---

<!-- Mobil: ta bort rundade hörn/shadow, minimal padding -->
<!-- MOBIL: Inga block. DESKTOP: Block-design -->
<section id="eftervard" class="mb-6 sm:mb-8 scroll-mt-32">
  <div class="bg-white sm:rounded-xl sm:shadow-md sm:border sm:border-gray-100 p-3 sm:p-4">
    <!-- Rubrik med ikon -->
    <div class="flex items-center gap-2.5 sm:gap-3 mb-2.5 sm:mb-3 pb-2.5 sm:pb-3 border-b border-gray-100">
      <img src="/images/operation/plaster-24x24.svg" alt="" class="w-8 h-8 sm:w-10 sm:h-10" />
      <h2 class="text-lg font-bold text-[#024264]">Bandage</h2>
    </div>

    <!-- Bandagetyper -->
    <div class="grid md:grid-cols-3 gap-2 sm:gap-3 mb-2.5 sm:mb-3">
      <!-- Stygn -->
      {visaStygn && (
        <div class="bg-amber-50 rounded-lg p-3 border border-amber-100">
          <div class="flex gap-2 items-start">
            <button 
              type="button"
              id="bandage-stygn-thumbnail"
              class="cursor-pointer group relative shrink-0"
              aria-label="Visa bild i full storlek"
            >
              <img 
                src={bandageStygn.src} 
                alt="Stygn efter operation" 
                width="40"
                height="40"
                loading="lazy"
                decoding="async"
                class="w-10 h-10 object-cover rounded border border-amber-300 group-hover:border-amber-500 transition-colors"
              />
              <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded flex items-center justify-center transition-colors">
                <svg class="w-3 h-3 text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
                </svg>
              </div>
            </button>
            <div class="flex-1 min-w-0">
              <h3 class="font-semibold text-slate-800 text-sm">Stygn</h3>
              <p class="text-sm text-slate-500">Sydda hål i huden</p>
            </div>
          </div>
        </div>
      )}
      
      <!-- Inre bandage -->
      <div class="bg-emerald-50 rounded-lg p-3 border border-emerald-100">
        <div class="flex gap-2 items-start">
          <button 
            type="button"
            id="bandage-inre-thumbnail"
            class="cursor-pointer group relative shrink-0"
            aria-label="Visa bild i full storlek"
          >
            <img 
              src={bandageInre.src} 
              alt="Inre bandage" 
              width="40"
              height="40"
              loading="lazy"
              decoding="async"
              class="w-10 h-10 object-cover rounded border border-emerald-300 group-hover:border-emerald-500 transition-colors"
            />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded flex items-center justify-center transition-colors">
              <svg class="w-3 h-3 text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
              </svg>
            </div>
          </button>
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-slate-800 text-sm">Inre bandage</h3>
            <p class="text-sm text-slate-500">Håller rent 2 dygn</p>
          </div>
        </div>
      </div>
      
      <!-- Yttre bandage -->
      <div class="bg-sky-50 rounded-lg p-3 border border-sky-100">
        <div class="flex gap-2 items-start">
          <button 
            type="button"
            id="bandage-yttre-thumbnail"
            class="cursor-pointer group relative shrink-0"
            aria-label="Visa bild i full storlek"
          >
            <img 
              src={bandageYttre.src} 
              alt="Yttre bandage" 
              width="40"
              height="40"
              loading="lazy"
              decoding="async"
              class="w-10 h-10 object-cover rounded border border-sky-300 group-hover:border-sky-500 transition-colors"
            />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded flex items-center justify-center transition-colors">
              <svg class="w-3 h-3 text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
              </svg>
            </div>
          </button>
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-slate-800 text-sm">Yttre bandage</h3>
            <p class="text-sm text-slate-500">Absorberar vätska</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Skötsel av bandage -->
    <div class="mt-3 pt-3 border-t border-gray-100 space-y-2 text-slate-600">
      <p>
        Om det blir väldigt blött eller slaskigt ska du byta det yttre bandaget. 
        Det är bättre att byta än att ha en blöt massa där bakterier kan ansamlas.
      </p>
      <p>
        <strong>Det inre bandaget</strong> låter du sitta kvar om du behöver byta tidigt. 
        <strong>Det yttre bandaget</strong> kan du ersätta med vilket absorberande förband som helst från apoteket.
      </p>
      <p>
        Efter ca en vecka kan du helt ta av bandaget, eller vänta tills stygnen tas bort.
      </p>
    </div>
  </div>

  {extraInfo && (
    <div class="mt-4 bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm text-blue-800">
      {extraInfo}
    </div>
  )}

  <!-- Blåmärken/Hematom - separat block -->
  <div class="mt-6 bg-white rounded-xl shadow-md border border-gray-100 p-4">
    <!-- Rubrik -->
    <h2 class="text-lg font-bold text-[#024264] mb-3">Blåmärken (Hematom)</h2>
    
    <div class="space-y-2 text-slate-700">
      <p>
        När man byter bandage kan man ibland se ett större eller mindre blåmärke i operationsområdet. 
        Det är helt normalt eftersom det blöder när man blir opererad.
      </p>
      <p>
        Dessa blåmärken är ofarliga. Men undantagsvis kan de bli ganska stora och ibland vandra neråt mot underarmen. 
        Risk för blåmärken i över- eller underarm ökar naturligtvis om du står på blodförtunnande medicin.
      </p>
    </div>
  </div>

  <!-- Suturer - separat block -->
  <div class="mt-6 bg-white rounded-xl shadow-md border border-gray-100 p-4">
    <!-- Rubrik med ikon -->
    <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100">
      <img src="/images/operation/sutur-24x24.svg" alt="" class="w-10 h-10" />
      <h2 class="text-lg font-bold text-[#024264]">Suturer</h2>
    </div>
    
    <p class="text-slate-700">
      Stygn tas bort efter <strong>{stygnBorttagning}</strong> hos distriktssköterskan.
    </p>
  </div>

  <!-- Lightbox Modal med bildspel -->
  <div 
    id="bandage-lightbox" 
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4"
    role="dialog"
    aria-modal="true"
    aria-label="Bandagebilder - bildspel"
  >
    <button 
      type="button"
      id="bandage-lightbox-close"
      class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-20"
      aria-label="Stäng"
    >
      <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
    
    <!-- Föregående knapp -->
    <button 
      type="button"
      id="bandage-lightbox-prev"
      class="absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors z-20 bg-black/50 rounded-full p-2"
      aria-label="Föregående bild"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    
    <!-- Nästa knapp -->
    <button 
      type="button"
      id="bandage-lightbox-next"
      class="absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors z-20 bg-black/50 rounded-full p-2"
      aria-label="Nästa bild"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
    
    <div class="relative max-w-4xl w-full">
      <img 
        id="bandage-lightbox-image"
        src=""
        alt=""
        class="w-full h-auto rounded-xl shadow-2xl"
      />
      <div class="text-white text-center mt-4">
        <p id="bandage-lightbox-title" class="text-lg font-medium"></p>
        <p id="bandage-lightbox-counter" class="text-sm text-gray-300 mt-1"></p>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ bandageStygnSrc: bandageStygn.src, bandageInreSrc: bandageInre.src, bandageYttreSrc: bandageYttre.src }}>
  // Bildspel-lightbox för bandagebilder
  document.addEventListener('DOMContentLoaded', () => {
    const bandageImages = [
      { src: bandageStygnSrc, alt: 'Stygn efter operation', title: 'Stygn' },
      { src: bandageInreSrc, alt: 'Inre bandage', title: 'Inre bandage' },
      { src: bandageYttreSrc, alt: 'Yttre bandage', title: 'Yttre bandage' }
    ];
    
    let currentImageIndex = 0;
    const lightbox = document.getElementById('bandage-lightbox');
    const lightboxImage = document.getElementById('bandage-lightbox-image');
    const lightboxTitle = document.getElementById('bandage-lightbox-title');
    const lightboxCounter = document.getElementById('bandage-lightbox-counter');
    const closeBtn = document.getElementById('bandage-lightbox-close');
    const prevBtn = document.getElementById('bandage-lightbox-prev');
    const nextBtn = document.getElementById('bandage-lightbox-next');
    
    // Funktion för att visa bild i lightbox
    function showImage(index) {
      currentImageIndex = index;
      const image = bandageImages[index];
      lightboxImage.src = image.src;
      lightboxImage.alt = image.alt;
      lightboxTitle.textContent = image.title;
      lightboxCounter.textContent = `${index + 1} av ${bandageImages.length}`;
    }
    
    // Funktion för att öppna lightbox
    function openLightbox(index) {
      showImage(index);
      lightbox.classList.remove('hidden');
      lightbox.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }
    
    // Funktion för att stänga lightbox
    function closeLightbox() {
      lightbox.classList.add('hidden');
      lightbox.classList.remove('flex');
      document.body.style.overflow = '';
    }
    
    // Föregående bild
    function showPrev() {
      const newIndex = currentImageIndex === 0 ? bandageImages.length - 1 : currentImageIndex - 1;
      showImage(newIndex);
    }
    
    // Nästa bild
    function showNext() {
      const newIndex = currentImageIndex === bandageImages.length - 1 ? 0 : currentImageIndex + 1;
      showImage(newIndex);
    }
    
    // Event listeners för thumbnails
    document.getElementById('bandage-stygn-thumbnail')?.addEventListener('click', () => openLightbox(0));
    document.getElementById('bandage-inre-thumbnail')?.addEventListener('click', () => openLightbox(1));
    document.getElementById('bandage-yttre-thumbnail')?.addEventListener('click', () => openLightbox(2));
    
    // Event listeners för lightbox
    closeBtn?.addEventListener('click', closeLightbox);
    prevBtn?.addEventListener('click', showPrev);
    nextBtn?.addEventListener('click', showNext);
    
    // Stäng vid klick utanför bilden
    lightbox?.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });
    
    // Tangentbordsnavigation
    document.addEventListener('keydown', (e) => {
      if (lightbox && !lightbox.classList.contains('hidden')) {
        if (e.key === 'Escape') {
          closeLightbox();
        } else if (e.key === 'ArrowLeft') {
          showPrev();
        } else if (e.key === 'ArrowRight') {
          showNext();
        }
      }
    });
  });
</script>

