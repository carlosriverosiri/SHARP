---
/**
 * Kort varsel-indikator f칬r header
 * 
 * Visar en liten prick bredvid personalportal-ikonen n칛r det finns
 * aktiva kort varsel-kampanjer.
 * 
 * Inkludera denna komponent i headern eller BaseLayout.
 */
---

<div id="kort-varsel-indikator" class="hidden">
  <a 
    href="/personal/kort-varsel" 
    class="fixed bottom-4 right-4 z-50 flex items-center gap-2 px-4 py-3 bg-white rounded-full shadow-lg border border-gray-200 hover:shadow-xl transition-shadow"
    title="Aktiv kort varsel-kampanj"
  >
    <span id="kv-status-icon" class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></span>
    <span id="kv-status-text" class="text-sm font-medium text-gray-700">Aktiv kampanj</span>
  </a>
</div>

<script>
  async function checkKortVarselStatus() {
    try {
      const response = await fetch('/api/kampanj/aktiv');
      if (!response.ok) return;
      
      const data = await response.json();
      const indikator = document.getElementById('kort-varsel-indikator');
      const icon = document.getElementById('kv-status-icon');
      const text = document.getElementById('kv-status-text');
      
      if (data.harAktiv && indikator && icon && text) {
        indikator.classList.remove('hidden');
        
        if (data.status === 'fylld') {
          // Gul - n친gon svarade JA, v칛ntar p친 bekr칛ftelse
          icon.classList.remove('bg-red-500');
          icon.classList.add('bg-yellow-500');
          text.textContent = '游꿀 N친gon svarade JA!';
        } else {
          // R칬d - v칛ntar p친 svar
          icon.classList.remove('bg-yellow-500');
          icon.classList.add('bg-red-500');
          const antal = data.antalAktiva || 1;
          text.textContent = antal > 1 ? `${antal} aktiva kampanjer` : 'Aktiv kampanj';
        }
      } else if (indikator) {
        indikator.classList.add('hidden');
      }
    } catch (e) {
      // Ignorera fel
    }
  }
  
  // Kolla status vid sidladdning (endast p친 personal-sidor)
  if (window.location.pathname.startsWith('/personal')) {
    checkKortVarselStatus();
    // Kolla igen var 30:e sekund
    setInterval(checkKortVarselStatus, 30000);
  }
</script>

<style>
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
</style>
