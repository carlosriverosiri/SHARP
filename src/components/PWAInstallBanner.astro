---
/**
 * PWA Install Banner
 * 
 * Visar banner för att uppmana patienter att spara sidan på hemskärmen.
 * Endast synlig på mobil.
 */
---

<div 
  id="pwa-install-banner" 
  class="fixed top-0 left-0 right-0 z-50 bg-[#EBF8FF] border-b-4 border-[#024264] transition-all duration-300 ease-in-out"
  style="display: none;"
>
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4">
    <p class="flex-1 pr-2 font-bold text-base md:text-lg text-[#024264]">
      Spara denna kallelse på hemskärmen för snabb åtkomst inför operationen.
    </p>
    
    <button 
      id="pwa-dismiss-btn"
      type="button"
      class="shrink-0 p-2 text-[#024264] hover:text-red-600 transition-colors"
      aria-label="Stäng"
    >
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
</div>

<script>
  /**
   * PWA Install Banner
   * Visar banner endast på mobil och hanterar dismiss via localStorage
   */
  
  function isMobile(): boolean {
    const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;
    const isAndroid = /android/i.test(userAgent);
    const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !(window as any).MSStream;
    const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
    const isSmallScreen = window.innerWidth <= 1024;

    return (isAndroid || isIOS) && hasTouch && isSmallScreen;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById('pwa-install-banner');
    const dismissBtn = document.getElementById('pwa-dismiss-btn');
    
    if (!banner || !dismissBtn) return;

    // Kolla om användaren har stängt bannern (per sida)
    const pathname = window.location.pathname;
    const dismissKey = `pwa-banner-dismissed-${pathname}`;
    const isDismissed = localStorage.getItem(dismissKey) === 'true';

    function showBanner() {
      if (isMobile() && !isDismissed) {
        banner.style.display = 'block';
        document.body.style.paddingTop = banner.offsetHeight + 'px';
      }
    }

    function hideBanner() {
      banner.style.transition = 'opacity 0.3s ease-in-out, height 0.3s ease-in-out';
      banner.style.opacity = '0';
      banner.style.height = '0';
      banner.style.overflow = 'hidden';
      
      setTimeout(() => {
        banner.style.display = 'none';
        localStorage.setItem(dismissKey, 'true');
        document.body.style.paddingTop = '';
      }, 300);
    }

    dismissBtn.addEventListener('click', hideBanner);
    
    // Visa banner om det är mobil och inte stängd
    showBanner();
  });
</script>
