---
/**
 * RECEPTPOLICY & FÖRPACKNINGSBYTEN
 * =================================
 * Informationssida för patienter och administrativ personal.
 * 
 * Skapad: 2026-01-04
 * Kortlänk: www.specialist.se/i/recept
 * 
 * Denna sida beskriver hur vi hanterar:
 * - Restnoterade läkemedel
 * - Förpackningsbyten på apotek
 * - Olika lösningar apoteket kan erbjuda
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';

// Importera illustrationer
import problemBild from '../../assets/images/info/56-tabletter-slut-i-lagret.webp';
import bytaStorlek from '../../assets/images/info/byta-storlek-pa-forpackning.webp';
import brytaForpackning from '../../assets/images/info/bryt-en-storre-forpackning-och-ta-bort-tabletter.webp';
import slaIhopUttag from '../../assets/images/info/sla-ihop-uttag.webp';

const pageTitle = "Receptpolicy & förpackningsbyten";
const pageDescription = "Information om hur vi hanterar restnoterade läkemedel och förpackningsbyten. Apotekets lösningar när din medicin är slut i lager.";

// Bilddata för lightbox
const galleryImages = [
  { 
    id: 0, 
    src: problemBild, 
    alt: "Patient får inte hjälp när medicinen är slut i lager",
    caption: "Problemet: Apoteket säger att medicinen är slut och att du behöver ett nytt recept – men det stämmer inte."
  },
  { 
    id: 1, 
    src: bytaStorlek, 
    alt: "Byta storlek på förpackning",
    caption: "Lösning: Apoteket kan ge dig två mindre förpackningar istället för en stor."
  },
  { 
    id: 2, 
    src: brytaForpackning, 
    alt: "Bryta en större förpackning och ta bort tabletter",
    caption: "Lösning: Apoteket kan öppna en större förpackning och räkna ut exakt antal tabletter."
  },
  { 
    id: 3, 
    src: slaIhopUttag, 
    alt: "Slå ihop flera uttag till ett",
    caption: "Lösning: Apoteket kan slå ihop flera uttag så du får alla tabletter på en gång."
  }
];
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    
    <!-- Sidhuvud -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center">
          <svg class="w-6 h-6 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
        </div>
        <h1 class="text-2xl md:text-3xl font-bold text-[#024264]">{pageTitle}</h1>
      </div>
      <p class="text-slate-600 text-lg">
        Information för dig som patient – och för apotekspersonal.
      </p>
    </div>

    <!-- Problemet: Medicin slut i lager -->
    <section class="mb-10">
      <div class="md:flex md:items-center md:gap-8 bg-slate-50 rounded-xl p-6 border border-slate-200">
        <div class="md:w-1/4 mb-4 md:mb-0">
          <button 
            type="button"
            class="gallery-thumb cursor-pointer hover:opacity-90 transition-opacity block w-full"
            data-index="0"
            aria-label="Visa bild i större format"
          >
            <Image 
              src={problemBild} 
              alt="Patient får inte hjälp när medicinen är slut i lager" 
              class="rounded-lg shadow-md w-full aspect-square object-cover"
              loading="eager"
            />
            <p class="text-xs text-slate-500 mt-2 text-center">Klicka för att förstora</p>
          </button>
        </div>
        <div class="md:w-3/4">
          <h2 class="text-xl font-bold text-slate-800 mb-3">När din medicin är slut på apoteket</h2>
          <p class="text-slate-600 mb-3">
            Ibland är den exakta förpackningsstorleken eller varumärket vi skrivit ut <strong>tillfälligt slut på apoteket</strong>. 
            Detta är vanligt och betyder inte att du behöver ett nytt recept.
          </p>
          <p class="text-slate-600">
            Apoteket har flera lösningar för att hjälpa dig – men <strong>de måste fråga dig först</strong> innan de kan använda dem.
          </p>
        </div>
      </div>
    </section>

    <!-- Vår policy -->
    <section class="mb-10">
      <div class="bg-amber-50 border-l-4 border-amber-400 rounded-r-xl p-6">
        <h2 class="text-xl font-bold text-amber-800 mb-3 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Vår policy
        </h2>
        <p class="text-amber-900 mb-3">
          <strong>Vi skriver inte om recept</strong> bara för att en viss förpackningsstorlek eller ett visst varumärke är slut. 
          Läkemedelsverkets regler ger apoteket rätt att lösa detta direkt.
        </p>
        <p class="text-amber-900">
          Om apoteket säger att de "inte kan göra något" – visa dem gärna denna sida eller be dem kontakta sin farmaceut.
        </p>
      </div>
    </section>

    <!-- Apotekets lösningar -->
    <section class="mb-10">
      <h2 class="text-2xl font-bold text-[#024264] mb-6">Apotekets lösningar</h2>
      
      <div class="space-y-6">
        
        <!-- Lösning 1: Byta storlek -->
        <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
          <div class="md:flex md:items-center md:gap-6">
            <div class="md:w-1/4 mb-4 md:mb-0">
              <button 
                type="button"
                class="gallery-thumb cursor-pointer hover:opacity-90 transition-opacity block w-full"
                data-index="1"
                aria-label="Visa bild i större format"
              >
                <Image 
                  src={bytaStorlek} 
                  alt="Byta storlek på förpackning" 
                  class="rounded-lg shadow-sm w-full aspect-square object-cover"
                  loading="lazy"
                />
                <p class="text-xs text-blue-600 mt-2 text-center">Klicka för att förstora</p>
              </button>
            </div>
            <div class="md:w-3/4">
              <h3 class="text-lg font-bold text-blue-800 mb-2">Byta storlek på förpackning</h3>
              <p class="text-blue-900">
                Om receptet säger 100 tabletter men apoteket bara har 50-pack, 
                <strong>får apoteket ge dig två 50-pack istället</strong>. 
                Du betalar samma pris som för ett 100-pack.
              </p>
            </div>
          </div>
        </div>

        <!-- Lösning 2: Bryta förpackning -->
        <div class="bg-emerald-50 rounded-xl p-6 border border-emerald-200">
          <div class="md:flex md:items-center md:gap-6 md:flex-row-reverse">
            <div class="md:w-1/4 mb-4 md:mb-0">
              <button 
                type="button"
                class="gallery-thumb cursor-pointer hover:opacity-90 transition-opacity block w-full"
                data-index="2"
                aria-label="Visa bild i större format"
              >
                <Image 
                  src={brytaForpackning} 
                  alt="Bryta en större förpackning och ta bort tabletter" 
                  class="rounded-lg shadow-sm w-full aspect-square object-cover"
                  loading="lazy"
                />
                <p class="text-xs text-emerald-600 mt-2 text-center">Klicka för att förstora</p>
              </button>
            </div>
            <div class="md:w-3/4">
              <h3 class="text-lg font-bold text-emerald-800 mb-2">Bryta förpackning</h3>
              <p class="text-emerald-900">
                Om receptet säger 30 tabletter men apoteket bara har 100-pack, 
                <strong>får apoteket öppna förpackningen och räkna ut 30 tabletter</strong>. 
                Du betalar bara för det du får.
              </p>
            </div>
          </div>
        </div>

        <!-- Lösning 3: Slå ihop uttag -->
        <div class="bg-purple-50 rounded-xl p-6 border border-purple-200">
          <div class="md:flex md:items-center md:gap-6">
            <div class="md:w-1/4 mb-4 md:mb-0">
              <button 
                type="button"
                class="gallery-thumb cursor-pointer hover:opacity-90 transition-opacity block w-full"
                data-index="3"
                aria-label="Visa bild i större format"
              >
                <Image 
                  src={slaIhopUttag} 
                  alt="Slå ihop flera uttag till ett" 
                  class="rounded-lg shadow-sm w-full aspect-square object-cover"
                  loading="lazy"
                />
                <p class="text-xs text-purple-600 mt-2 text-center">Klicka för att förstora</p>
              </button>
            </div>
            <div class="md:w-3/4">
              <h3 class="text-lg font-bold text-purple-800 mb-2">Slå ihop uttag</h3>
              <p class="text-purple-900">
                Om du har flera uttag kvar på receptet och vill hämta ut allt på en gång, 
                <strong>kan apoteket slå ihop uttagen</strong>. 
                Du måste ge ditt samtycke.
              </p>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- Din åtgärd som patient -->
    <section class="mb-10">
      <div class="bg-green-50 border border-green-200 rounded-xl p-6">
        <h2 class="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Vad du som patient kan göra
        </h2>
        <ul class="text-green-900 space-y-2">
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-1">✓</span>
            <span><strong>Fråga apoteket</strong> om de kan byta storlek, bryta förpackning eller slå ihop uttag</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-1">✓</span>
            <span><strong>Ge ditt samtycke</strong> när apoteket frågar om du accepterar en annan lösning</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-1">✓</span>
            <span><strong>Visa denna sida</strong> om apoteket är osäkra på vad de får göra</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-1">✓</span>
            <span><strong>Byt till ett annat apotek</strong> som har bättre lager eller mer flexibel personal</span>
          </li>
        </ul>
      </div>
    </section>

    <!-- Kortlänk för personal -->
    <section class="mb-8">
      <div class="bg-slate-100 rounded-lg p-4 text-center">
        <p class="text-sm text-slate-600 mb-2">
          <strong>Kortlänk till denna sida:</strong>
        </p>
        <code class="bg-white px-3 py-1 rounded border text-[#024264] font-mono">
          www.specialist.se/i/recept
        </code>
      </div>
    </section>

    <!-- Tillbaka-länk -->
    <div class="text-center">
      <a href="/operation/axel/lateral-klavikelresektion" class="inline-flex items-center gap-2 text-[#024264] hover:text-blue-700 font-medium">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Tillbaka till operationssidan
      </a>
    </div>

  </main>

  <!-- ============================================
       LIGHTBOX / BILDVISARE
       Visar bilder i fullskärm med bildtext och navigation
       ============================================ -->
  <div 
    id="lightbox" 
    class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-4"
    role="dialog"
    aria-modal="true"
    aria-label="Bildvisare"
  >
    <!-- Stäng-knapp -->
    <button 
      id="lightbox-close" 
      type="button"
      class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10"
      aria-label="Stäng bildvisare"
    >
      <svg class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Föregående-knapp -->
    <button 
      id="lightbox-prev" 
      type="button"
      class="absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors bg-black/50 rounded-full p-2"
      aria-label="Föregående bild"
    >
      <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>

    <!-- Nästa-knapp -->
    <button 
      id="lightbox-next" 
      type="button"
      class="absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors bg-black/50 rounded-full p-2"
      aria-label="Nästa bild"
    >
      <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>

    <!-- Bildcontainer -->
    <div class="max-w-4xl w-full text-center">
      <img 
        id="lightbox-image" 
        src="" 
        alt="" 
        class="max-h-[70vh] mx-auto rounded-lg shadow-2xl"
      />
      <!-- Bildtext -->
      <div class="mt-4 bg-black/70 rounded-lg px-6 py-4 mx-auto max-w-2xl">
        <p id="lightbox-caption" class="text-white text-lg"></p>
        <p id="lightbox-counter" class="text-gray-400 text-sm mt-2"></p>
      </div>
    </div>
  </div>
</BaseLayout>

<script define:vars={{ galleryImages }}>
  // Bilddata för lightbox (kommer från Astro)
  const images = galleryImages;
  
  document.addEventListener('DOMContentLoaded', () => {
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxCaption = document.getElementById('lightbox-caption');
    const lightboxCounter = document.getElementById('lightbox-counter');
    const closeBtn = document.getElementById('lightbox-close');
    const prevBtn = document.getElementById('lightbox-prev');
    const nextBtn = document.getElementById('lightbox-next');
    const thumbs = document.querySelectorAll('.gallery-thumb');
    
    let currentIndex = 0;
    
    // Öppna lightbox
    function openLightbox(index) {
      currentIndex = index;
      updateLightbox();
      lightbox.classList.remove('hidden');
      lightbox.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }
    
    // Stäng lightbox
    function closeLightbox() {
      lightbox.classList.add('hidden');
      lightbox.classList.remove('flex');
      document.body.style.overflow = '';
    }
    
    // Uppdatera lightbox-innehåll
    function updateLightbox() {
      const img = images[currentIndex];
      // Hämta den faktiska bildens src från thumbnailsens img-element
      const thumbImg = thumbs[currentIndex].querySelector('img');
      lightboxImage.src = thumbImg.src;
      lightboxImage.alt = img.alt;
      lightboxCaption.textContent = img.caption;
      lightboxCounter.textContent = `Bild ${currentIndex + 1} av ${images.length}`;
    }
    
    // Visa föregående bild
    function showPrev() {
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      updateLightbox();
    }
    
    // Visa nästa bild
    function showNext() {
      currentIndex = (currentIndex + 1) % images.length;
      updateLightbox();
    }
    
    // Event listeners för thumbnails
    thumbs.forEach(thumb => {
      thumb.addEventListener('click', () => {
        const index = parseInt(thumb.dataset.index, 10);
        openLightbox(index);
      });
    });
    
    // Event listeners för lightbox-knappar
    closeBtn.addEventListener('click', closeLightbox);
    prevBtn.addEventListener('click', showPrev);
    nextBtn.addEventListener('click', showNext);
    
    // Stäng vid klick utanför bilden
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });
    
    // Tangentbordsnavigation
    document.addEventListener('keydown', (e) => {
      if (lightbox.classList.contains('hidden')) return;
      
      switch (e.key) {
        case 'Escape':
          closeLightbox();
          break;
        case 'ArrowLeft':
          showPrev();
          break;
        case 'ArrowRight':
          showNext();
          break;
      }
    });
  });
</script>
